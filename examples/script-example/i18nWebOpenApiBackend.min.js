!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).i18nWebOpenApiBackend=n()}(this,(function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},e.apply(this,arguments)};function n(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,c)}s((r=r.apply(e,n||[])).next())}))}function t(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=n.call(e,i)}catch(e){c=[6,e],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}function r(e){return e.json()}function o(e){if(e.status>=200&&e.status<300)return e;var n=new Error(e.statusText);throw n.response=e,n}function a(e,n){var t={"Content-Type":"application/x-www-form-urlencoded"};return function(e,n){return fetch(e,n).then(o).then(r).then((function(e){return{data:e}})).catch((function(e){return{err:e}}))}(e,{method:"POST",headers:t,body:Object.keys(n).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(n[e]))})).join("&"),credentials:"omit"})}function i(e,r){return n(this,void 0,void 0,(function(){var n,o,i;return t(this,(function(t){switch(t.label){case 0:return[4,a(e,r)];case 1:if(n=t.sent(),o=n.data,i=n.err)throw i;if(o&&0===o.code)return[2,o.data];throw new Error(null==o?void 0:o.message)}}))}))}var c={prod:"https://i18n.mykeeta.com",test:"https://i18n.mykeeta.com",dev:"https://ocean.waimai.test.sankuai.com"},s={dev:{checkTextVersion:"/api/openapi/v1/package",fetchText:"/api/openapi/v1/text"},test:{checkTextVersion:"/api/openapi/v1/package_test",fetchText:"/api/openapi/v1/text_test"},prod:{checkTextVersion:"/api/openapi/v1/package",fetchText:"/api/openapi/v1/text"}};function u(e,r){return void 0===r&&(r="prod"),n(this,void 0,void 0,(function(){return t(this,(function(n){return[2,i("".concat(c[r]).concat(s[r].checkTextVersion),e)]}))}))}function p(e,r){return void 0===r&&(r="prod"),n(this,void 0,void 0,(function(){return t(this,(function(n){return[2,i("".concat(c[r]).concat(s[r].fetchText),e)]}))}))}var l=function(){function r(e,n,t){this.init(e,n,t)}return r.prototype.getDefauleNs=function(e){var n=(e||{}).defaultNS;return"string"==typeof n?n:Array.isArray(n)&&n.length>0?n[0]:""},r.prototype.normalizeOptions=function(e){var n=this.backendOptions.namespaces,t=n.length,r=this.getDefauleNs(e);if(1!==t){if(t>1)for(var o=!1,a=[],i=0,c=n;i<c.length;i++){var s=c[i];if(!s.name){if(console.error("OpenAPIBackend parameter error: ensure that the name value in the namespace not empty"),o)return void console.error("OpenAPIBackend parameter error: ensure that the name value in the namespace is unique");o=!0,s.name=r}if(a.includes(s.name))return void console.error("OpenAPIBackend parameter error: ensure that the name value in the namespace is unique");a.push(s.name)}}else{var u=n[0];u.name||(u.name=r)}},r.prototype.init=function(n,t,r){this.services=n,this.backendOptions=e(e({},{namespaces:[],env:"prod"}),t),this.normalizeOptions(r),this.type="backend"},r.prototype.getCacheKey=function(e,n,t,r){return"".concat(e,"_").concat(n,"_").concat(t,"_").concat(r)},r.prototype.read=function(e,r,o){return n(this,void 0,void 0,(function(){var n,a,i,c,s,l,f,h,d,v,m,y,g,k;return t(this,(function(t){switch(t.label){case 0:if(n=this.backendOptions,a=n.env,i=n.namespaces,!(c=i.find((function(e){return e.name===r}))))return[2,o(new Error("The space does not exist in the configuration"),null)];s=c.projectId,l=c.namespaceId,f={projectId:s,namespaceId:l,locale:e,onlyVersion:0},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,u(f,a)];case 2:return h=t.sent(),d=this.getCacheKey(s,l,e,r),h.packages&&h.packages.length>0&&(v=window.localStorage.getItem(d),m=v?JSON.parse(v):{},y=h.packages[0],m&&m.version&&y.version===m.version)?[2,o(null,m.kv)]:[4,p(f,a)];case 3:return(g=t.sent()).version&&g.kv?(window.localStorage.setItem(d,JSON.stringify(g)),[2,o(null,g.kv)]):[2,o(new Error("language package empty"),null)];case 4:return k=t.sent(),[2,o(k,null)];case 5:return[2]}}))}))},r}();return l.type="backend",l}));
